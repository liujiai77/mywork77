<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>åœ¨çº¿è´­ç‰©æŠ˜æ‰£ç³»ç»Ÿ</title>
    <style type="text/css">
        body {
            font-family: Arial, Helvetica, sans-serif;
            margin: 20px;
            background-color: #ffffff;
        }
        h1 {
            color: #0066cc;
            text-align: center;
            border-bottom: 2px solid #0066cc;
            padding-bottom: 10px;
        }
        .form-div {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #cccccc;
            background-color: #f9f9f9;
        }
        .form-item {
            margin: 10px 0;
            line-height: 30px;
        }
        label {
            display: inline-block;
            width: 120px;
            text-align: right;
            margin-right: 10px;
            font-weight: bold;
        }
        input[type="text"], input[type="number"], select {
            width: 200px;
            height: 25px;
            border: 1px solid #cccccc;
            padding: 2px 5px;
        }
        button {
            margin-left: 130px;
            padding: 5px 15px;
            background-color: #0066cc;
            color: #ffffff;
            border: none;
            cursor: pointer;
            height: 30px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #004499;
        }
        #clock {
            text-align: center;
            font-size: 16px;
            color: #ff0000;
            margin: 10px 0;
            padding: 5px;
            background-color: #f0f0f0;
        }
        #tips {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #cccccc;
            background-color: #f0f8ff;
            line-height: 25px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #cccccc;
            padding: 8px;
            text-align: center;
        }
        th {
            background-color: #0066cc;
            color: #ffffff;
        }
        tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        .notice {
            text-align: center;
            color: #ff0000;
            font-weight: bold;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>åœ¨çº¿è´­ç‰©æŠ˜æ‰£è®¢å•ç³»ç»Ÿ</h1>
    
    <!-- æŠ˜æ‰£æé†’ï¼ˆdocument.writeå®ç°ï¼‰ -->
    <script type="text/javascript">
        document.write('<p class="notice">ğŸ“¢ å¹³å°è§„åˆ™ï¼šVIPäº«9æŠ˜ä¼˜æƒ ï¼ŒåŠ æ€¥è®¢å•åŠ æ”¶1æˆè´¹ç”¨ï¼Œæ¯å°æ—¶å‰10åˆ†é’Ÿäº«85æŠ˜ï¼Œæ•°é‡â‰¥5ä»¶å åŠ 8æŠ˜ï¼</p>');
    </script>

    <!-- æ¨¡æ‹Ÿæ—¶é’Ÿ -->
    <div id="clock"></div>

    <!-- è®¢å•è¡¨å• -->
    <div class="form-div">
        <div class="form-item">
            <label for="customerName">å®¢æˆ·åç§°ï¼š</label>
            <input type="text" id="customerName" placeholder="è¯·è¾“å…¥å®¢æˆ·å§“å">
        </div>
        <div class="form-item">
            <label for="price">å•†å“å•ä»·ï¼š</label>
            <input type="number" id="price" step="0.01" min="0" placeholder="è¯·è¾“å…¥å¤§äº0çš„æ•°å­—">
        </div>
        <div class="form-item">
            <label for="quantity">è´­ä¹°æ•°é‡ï¼š</label>
            <input type="number" id="quantity" step="1" min="0" placeholder="è¯·è¾“å…¥å¤§äº0çš„æ•´æ•°">
        </div>
        <div class="form-item">
            <label for="isVip">å®¢æˆ·ç±»å‹ï¼š</label>
            <select id="isVip">
                <option value="false">æ™®é€šå®¢æˆ·</option>
                <option value="true">VIPå®¢æˆ·</option>
            </select>
        </div>
        <div class="form-item">
            <label for="isUrgent">æ˜¯å¦åŠ æ€¥ï¼š</label>
            <select id="isUrgent">
                <option value="false">å¦</option>
                <option value="true">æ˜¯</option>
            </select>
        </div>
        <button onclick="addOrder()">æ·»åŠ è®¢å•</button>
        <button onclick="renderDashboard()">æŸ¥çœ‹æˆäº¤è®°å½•</button>
    </div>

    <!-- è®¢å•è®¡ç®—ç»“æœ -->
    <div id="tips"></div>

    <!-- æˆäº¤è®°å½•è¡¨æ ¼ -->
    <div id="dashboard">
        <h2 style="color: #0066cc; text-align: center;">æˆäº¤å†å²è®°å½•</h2>
        <table id="orderTable">
            <thead>
                <tr>
                    <th>å®¢æˆ·åç§°</th>
                    <th>å•†å“å•ä»·</th>
                    <th>è´­ä¹°æ•°é‡</th>
                    <th>å®¢æˆ·ç±»å‹</th>
                    <th>æ˜¯å¦åŠ æ€¥</th>
                    <th>æœ€ç»ˆæ€»ä»·</th>
                    <th>ä¸‹å•æ—¶é—´</th>
                </tr>
            </thead>
            <tbody id="orderBody">
                <tr>
                    <td colspan="7">æš‚æ— æˆäº¤è®°å½•</td>
                </tr>
            </tbody>
        </table>
    </div>

    <script type="text/javascript">
        // å…¨å±€è®¢å•å†å²æ•°ç»„
        let orderHistory = [];

        // 1. æ¨¡æ‹Ÿæ—¶é’Ÿ + æ—¶æ®µæŠ˜æ‰£æé†’
        function updateClock() {
            const now = new Date();
            const sec = now.getSeconds().toString().padStart(2, '0');
            const min = now.getMinutes().toString().padStart(2, '0');
            const hour = now.getHours().toString().padStart(2, '0');
            const week = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][now.getDay()];
            const date = now.getDate().toString().padStart(2, '0');
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const year = now.getFullYear();

            const timeStr = `${year}å¹´${month}æœˆ${date}æ—¥ æ˜ŸæœŸ${week} ${hour}:${min}:${sec}`;
            const clockEl = document.getElementById('clock');
            
            if (now.getMinutes() < 10) {
                clockEl.innerHTML = `å½“å‰æ—¶é—´ï¼š${timeStr} | ğŸŒŸ æ¯å°æ—¶å‰10åˆ†é’Ÿï¼Œäº«85æŠ˜ä¼˜æƒ ï¼Œæ•°é‡â‰¥5ä»¶å åŠ 8æŠ˜ï¼`;
            } else {
                clockEl.innerHTML = `å½“å‰æ—¶é—´ï¼š${timeStr} | âš ï¸ éæŠ˜æ‰£æ—¶æ®µï¼Œä»…VIPäº«9æŠ˜ä¼˜æƒ `;
            }
        }
        updateClock();
        setInterval(updateClock, 1000);

        // 2. æ•°æ®æ ¡éªŒå‡½æ•°
        function validateData(name, price, quantity) {
            if (!name || name.trim() === '') {
                alert('é”™è¯¯ï¼šå®¢æˆ·åç§°ä¸èƒ½ä¸ºç©ºï¼');
                return false;
            }
            if (isNaN(price) || price <= 0) {
                alert('é”™è¯¯ï¼šå•†å“å•ä»·å¿…é¡»æ˜¯å¤§äº0çš„æ•°å­—ï¼');
                return false;
            }
            if (isNaN(quantity) || quantity <= 0 || !Number.isInteger(Number(quantity))) {
                alert('é”™è¯¯ï¼šè´­ä¹°æ•°é‡å¿…é¡»æ˜¯å¤§äº0çš„æ•´æ•°ï¼');
                return false;
            }
            return true;
        }

        // 3. æ·»åŠ è®¢å•æ ¸å¿ƒé€»è¾‘
        function addOrder() {
            // è·å–è¡¨å•æ•°æ®
            const customerName = document.getElementById('customerName').value;
            const price = parseFloat(document.getElementById('price').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            const isVip = document.getElementById('isVip').value === 'true';
            const isUrgent = document.getElementById('isUrgent').value === 'true';

            // æ•°æ®æ ¡éªŒ
            if (!validateData(customerName, price, quantity)) {
                return;
            }

            // ä»·æ ¼è®¡ç®—é€»è¾‘
            const baseTotal = price * quantity; // åŸºç¡€æ€»ä»·
            let afterVip = isVip ? baseTotal * 0.9 : baseTotal; // VIPæŠ˜æ‰£å
            let afterUrgent = isUrgent ? afterVip * 1.1 : afterVip; // åŠ æ€¥åŠ ä»·å
            
            const now = new Date();
            const minute = now.getMinutes();
            const hitTimeDiscount = minute >= 0 && minute <= 9;
            let finalTotal = hitTimeDiscount ? afterUrgent * 0.85 : afterUrgent;

            // å åŠ æŠ˜æ‰£ï¼šå‰10åˆ†é’Ÿä¸”æ•°é‡â‰¥5ä»¶ï¼Œå†æ‰“8æŠ˜
            if (hitTimeDiscount && quantity >= 5) {
                finalTotal = finalTotal * 0.8;
            }

            // æ„å»ºç»“æœå±•ç¤ºå†…å®¹
            let tipsHtml = '';
            tipsHtml += 'å®¢æˆ·åç§°ï¼š' + customerName + '<br>';
            tipsHtml += 'å•†å“å•ä»·ï¼šÂ¥' + price.toFixed(2) + '<br>';
            tipsHtml += 'è´­ä¹°æ•°é‡ï¼š' + quantity + 'ä»¶<br>';
            tipsHtml += 'å®¢æˆ·ç±»å‹ï¼š' + (isVip ? 'VIPå®¢æˆ·ï¼ˆäº«9æŠ˜ï¼‰' : 'æ™®é€šå®¢æˆ·') + '<br>';
            tipsHtml += 'æ˜¯å¦åŠ æ€¥ï¼š' + (isUrgent ? 'æ˜¯ï¼ˆåŠ æ”¶1æˆè´¹ç”¨ï¼‰' : 'å¦') + '<br>';
            tipsHtml += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>';
            tipsHtml += 'æ­£å¸¸æ€»ä»·ï¼šÂ¥' + baseTotal.toFixed(2) + '<br>';
            tipsHtml += 'VIPæŠ˜æ‰£åä»·æ ¼ï¼šÂ¥' + afterVip.toFixed(2) + '<br>';
            tipsHtml += 'åŠ æ€¥åŠ ä»·åä»·æ ¼ï¼šÂ¥' + afterUrgent.toFixed(2) + '<br>';
            tipsHtml += 'æ—¶æ®µæŠ˜æ‰£ï¼š' + (hitTimeDiscount ? '85æŠ˜' : 'æ— ') + '<br>';
            tipsHtml += 'æ•°é‡å åŠ æŠ˜æ‰£ï¼š' + (hitTimeDiscount && quantity >= 5 ? '8æŠ˜' : 'æ— ') + '<br>';
            tipsHtml += 'â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€<br>';
            tipsHtml += '<strong>æœ€ç»ˆæ€»ä»·ï¼šÂ¥' + finalTotal.toFixed(2) + '</strong>';

            // æ˜¾ç¤ºè®¡ç®—ç»“æœ
            document.getElementById('tips').innerHTML = tipsHtml;

            // ä¿å­˜è®¢å•åˆ°å†å²è®°å½•
            orderHistory.push({
                name: customerName,
                price: price,
                quantity: quantity,
                vip: isVip ? 'VIPå®¢æˆ·' : 'æ™®é€šå®¢æˆ·',
                urgent: isUrgent ? 'æ˜¯' : 'å¦',
                finalTotal: finalTotal.toFixed(2),
                time: now.toLocaleString()
            });

            // æ¸…ç©ºè¡¨å•
            document.getElementById('customerName').value = '';
            document.getElementById('price').value = '';
            document.getElementById('quantity').value = '';
            document.getElementById('isVip').value = 'false';
            document.getElementById('isUrgent').value = 'false';
        }

        // 4. æ¸²æŸ“æˆäº¤è®°å½•é¢æ¿
        function renderDashboard() {
            const tableBody = document.getElementById('orderBody');
            tableBody.innerHTML = '';

            if (orderHistory.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="7">æš‚æ— æˆäº¤è®°å½•</td></tr>';
                return;
            }

            // éå†ç”Ÿæˆè®¢å•è¡Œ
            orderHistory.forEach(item => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${item.name}</td>
                    <td>Â¥${item.price.toFixed(2)}</td>
                    <td>${item.quantity}</td>
                    <td>${item.vip}</td>
                    <td>${item.urgent}</td>
                    <td>Â¥${item.finalTotal}</td>
                    <td>${item.time}</td>
                `;
                tableBody.appendChild(tr);
            });

            // ç»Ÿè®¡è¡Œ
            const totalOrders = orderHistory.length;
            const totalSales = orderHistory.reduce((sum, item) => sum + parseFloat(item.finalTotal), 0);
            const totalTr = document.createElement('tr');
            totalTr.style.backgroundColor = '#e6f7ff';
            totalTr.innerHTML = `
                <td colspan="5"><strong>æˆäº¤ç»Ÿè®¡</strong></td>
                <td colspan="2"><strong>æ€»è®¢å•æ•°ï¼š${totalOrders} | æ€»é”€å”®é¢ï¼šÂ¥${totalSales.toFixed(2)}</strong></td>
            `;
            tableBody.appendChild(totalTr);
        }
    </script>
</body>
</html>